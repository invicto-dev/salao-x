generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Setting {
  id                 String   @id @default(uuid())
  
  // Informações da Empresa
  nomeEmpresa        String
  cnpj               String   @unique
  endereco           String
  bairro             String
  cidade             String
  cep                String
  telefone           String
  email              String   @unique
  site               String?

  // Configurações de Negócio
  horarioFuncionamento Json     // Armazena Record<DiaSemana, Horario>
  intervaloPadrao     Int       // minutos
  antecedenciaMinima  Int       // minutos

  // Notificações
  notificarAgendamentos  Boolean
  notificarEstoqueBaixo  Boolean
  notificarAniversarios  Boolean
  whatsappAtivo          Boolean
  emailAtivo             Boolean

  // Sistema
  backupAutomatico    Boolean
  manterHistorico     Int      // meses
  timezone            String

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model Employee {
  id                 String   @id @default(uuid())
  nome               String
  email              String   @unique
  telefone           String
  funcao             String
  comissao           Decimal
  ativo              Boolean

  vendas             Sale[]

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Customer {
  id                 String   @id @default(uuid())
  nome               String
  telefone           String
  email              String?  @unique
  cpf                String?  @unique
  aniversario        DateTime?
  observacoes        String?  
  ativo              Boolean  @default(true)

  vendas             Sale[]

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Product {
  id                 String   @id @default(uuid())
  nome               String
  codigo             String?  @unique
  preco              Decimal?  
  custo              Decimal?  
  contarEstoque      Boolean  @default(true)
  estoque            Int?
  ativo              Boolean  @default(true)
  descricao          String?

  // Relation with Category
  categoriaId        String?
  categoria          Category? @relation(fields: [categoriaId], references: [id])

  itensVenda         SaleItem[]

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Service {
  id                 String   @id @default(uuid())
  nome               String
  codigo             String?  @unique
  valorEmAberto      Boolean  @default(false)
  preco              Decimal?  
  duracao            Int?
  ativo              Boolean  @default(true)
  descricao          String?

  // Relação with Category
  categoriaId        String?
  categoria          Category? @relation(fields: [categoriaId], references: [id])

  itensVenda         SaleItem[]

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model PaymentMethod {
  id                 String   @id @default(uuid())
  nome               String
  descricao          String?
  ativo              Boolean  @default(true)
  chavePix           String?

  pagamentos         SalePayment[]

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Category {
  id                 String   @id @default(uuid())
  nome               String
  descricao          String?
  ativo              Boolean  @default(true)

  products           Product[]
  services           Service[]

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

enum SaleStatus {
  PENDENTE
  PAGO
  CANCELADO
}

model Sale {
  id                 String   @id @default(uuid())
  clienteId          String?  // Customer optional (e.g sale avulso)
  cliente            Customer? @relation(fields: [clienteId], references: [id])
  funcionarioId      String?  // Funcionario optional (e.g sale avulso)
  funcionario        Employee? @relation(fields: [funcionarioId], references: [id])

  total              Decimal
  desconto           Decimal?
  acrescimo          Decimal?
  status             SaleStatus @default(PENDENTE)

  itens              SaleItem[]
  pagamentos         SalePayment[]

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model SaleItem {
  id                 String   @id @default(uuid())
  vendaId            String
  venda              Sale     @relation(fields: [vendaId], references: [id])

  produtoId          String?
  produto            Product? @relation(fields: [produtoId], references: [id])

  servicoId          String?
  servico            Service? @relation(fields: [servicoId], references: [id])

  quantidade         Int      @default(1)
  preco              Decimal
  subtotal           Decimal

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model SalePayment {
  id                 String   @id @default(uuid())
  vendaId            String
  venda              Sale     @relation(fields: [vendaId], references: [id])

  metodoDePagamentoId String
  metodoDePagamento   PaymentMethod @relation(fields: [metodoDePagamentoId], references: [id])

  valor              Decimal
  observacao         String?

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}
